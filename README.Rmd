---
title: "Dataset generation for the Danish Biodiversity council"
author: "Derek Corcoran"
date: "`r format(Sys.time(), '%d/%m, %Y')`"
output:
  bookdown::github_document2:
    fig_caption: true
    toc: true
bibliography: biblio.bib
---


# Objective

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = T,
  warning = F,
  message = F,
  error = F,
  tidy = T
)
knitr::read_chunk('ReusableCode.R')
```


<!-- badges: start -->
<!-- badges: end -->


The goal of this repository is to generate the data sets necessary to evaluate the current and potential area that is strictly and partially protected in Denmark, note that all codes will be collapsed so that only the code that the reader needs to see can be extended.

# Packages needed

All calculations were done using the R software [@Cran2021], and all the geospatial transformations and calculations where performed using the terra package [@Hijmans2022]. There are some datasets extracted from the geodata package [@Hijmans2021]. The magrittr package was use for piping [@Milton2020], and finally the SF package was used to generate the Cloud Optimized Rasters [@Pebesma2018].

<details style=\"margin-bottom:10px;\">
<summary>Load packages</summary>
```{r LoadPackages}

```
</details>

# Terrestrial ecosystems

## Data generation

In this Section we will try to solve for intersections within the data and incongruencies within the data, some of the polygons provided have topological issues so we need to rasterize them in order to resolve this issues easily.

### Raster template

In order to align all datasets together a template raster will be generated using a 10 by 10 meter grid equal area using the following code.

<details style=\"margin-bottom:10px;\">
<summary>Template raster</summary>
```{r TemplateRaster}

```
</details>

### Denmark's Area

To both crop the areas (some include ocean and terrestrial ecosystems) and to have a value of the total area of Denmark, we need to have a polygon of the coastline of the country. We used the GADM dataset version 4.0 using the geodata package [@global2022gadm ; @Hijmans2021] using the following code, the resulting polygon is shown in figure \@ref(fig:PlotDenmark)

<details style=\"margin-bottom:10px;\">
<summary>Denmark Area</summary>
```{r DenmarkArea}

```
</details>


```{r PlotDenmark,fig.cap="Polygon of Denmark according to GADM 4.0", echo = F}

```


The total area for Denmark according to that is `r prettyNum(round(Area_DK), big.mark = ",")` Square meters

### Paragraph 3 and dunes

Within paragraph 3 [@miljoportalP3] and dunes there are several overlaps, so the next code joins these two data sets and resolves overlaps. 

<details style=\"margin-bottom:10px;\">
<summary>Join paragraph 3 with klit and rasterize</summary>
```{r Paragraph-3-Klit-raster}

```
</details>

And then saves it first as a geotiff and then exports it to a Cloud Optimized Geotiff with a deflate compression which is a lossless compression. as seen in the following code

<details style=\"margin-bottom:10px;\">
<summary>Write paragraph 3 and klit</summary>
```{r Write-Paragraph-3-Klit}

```
</details>


## Results

# Ocean ecosystems

Sea and land are treated separately

* How much is 30% and 10% according to EU
  - All natura 2.000 is in the 30%
  
* How much is 30% and 10% according to Biodiversity counsel (Biodiversitetsradet)
  - What has to be improved for natura 2.000 can be part of the 30%

## Potential areas

* NATURA 2000
  - Habitat types
  - How much is paragraph 3
  - how much area of different categories
  
  
## For each layer

* Total Area by habitat type (SqKm or meters)
* Proportion of Denmark
* Source
* Column 10% strictly protected EU
* Column 10% strictly protected Biodiversitetsradet
* Column 30% protected EU
* Column 30% protected Biodiversitetsradet
* Intersection (matrix NxN intersections?)

## For sea

Map of preasures for each polygon

## Deadlines

* **31 may:** First figures


## Test files

* Natura 2000
* BES_NATURETYPER_SHAPE
* NATUR_VILDT_RESERVATER
* Markblokke2021 Overlap with natura 2000 and paragraph 3

## How interactive should we make this

# Session info

<details style=\"margin-bottom:10px;\">
<summary>Session info</summary>
```{r }
sessioninfo::session_info()
```
</details>

# References
