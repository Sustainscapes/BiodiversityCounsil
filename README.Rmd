---
title: "Dataset generation for the Danish Biodiversity council"
author: "Derek Corcoran"
date: "`r format(Sys.time(), '%d/%m, %Y')`"
output:
  bookdown::github_document2:
    fig_caption: true
    toc: true
bibliography: biblio.bib
---


# Objective

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = T,
  warning = F,
  message = F,
  error = F,
  tidy = T,
  cache = T
)
knitr::read_chunk('ReusableCode.R')
```


<!-- badges: start -->
<!-- badges: end -->


The goal of this repository is to generate the data sets necessary to evaluate the current and potential area that is strictly and partially protected in Denmark, note that all codes will be collapsed so that only the code that the reader needs to see can be extended.

# Packages needed

All calculations were done using the R software [@Cran2021], and all the geospatial transformations and calculations where performed using the terra package [@Hijmans2022]. There are some datasets extracted from the geodata package [@Hijmans2021]. The magrittr package was use for piping [@Milton2020], and finally the SF package was used to generate the Cloud Optimized Rasters [@Pebesma2018].

<details style=\"margin-bottom:10px;\">
<summary>Load packages</summary>
```{r LoadPackages, cache = F}

```
</details>

# Terrestrial ecosystems

## Data generation

In this Section we will try to solve for intersections within the data and incongruencies within the data, some of the polygons provided have topological issues so we need to rasterize them in order to resolve this issues easily.

### Raster template

In order to align all datasets together a template raster will be generated using a 10 by 10 meter grid equal area using the following code.

<details style=\"margin-bottom:10px;\">
<summary>Template raster</summary>
```{r TemplateRaster, cache=FALSE}

```
</details>

### Denmark's Area

To both crop the areas (some include ocean and terrestrial ecosystems) and to have a value of the total area of Denmark, we need to have a polygon of the coastline of the country. We used the GADM dataset version 4.0 using the geodata package [@global2022gadm ; @Hijmans2021] using the following code, the resulting polygon is shown in figure \@ref(fig:PlotDenmark)

<details style=\"margin-bottom:10px;\">
<summary>Denmark Area</summary>
```{r DenmarkArea, cache = F}

```
</details>


```{r PlotDenmark,fig.cap="Polygon of Denmark according to GADM 4.0", echo = F, cache = T}

```


The total area for Denmark according to that is `r prettyNum(round(Area_DK), big.mark = ",")` Square meters

### Paragraph 3 and dunes

Within paragraph 3 [@miljoportalP3] and dunes there are several overlaps, so the next code joins these two data sets and resolves overlaps. 

<details style=\"margin-bottom:10px;\">
<summary>Join paragraph 3 with klit and rasterize</summary>
```{r Paragraph-3-Klit-raster}

```
</details>

And then saves it first as a geotiff and then exports it to a Cloud Optimized Geotiff with a deflate compression which is a lossless compression. as seen in the following code

<details style=\"margin-bottom:10px;\">
<summary>Write paragraph 3 and klit</summary>
```{r Write-Paragraph-3-Klit, cache = T}

```
</details>

the results can be seen in figure \@ref(fig:PlotP3klit)

```{r PlotP3klit, fig.cap= "Plot of the areas of Paragraph 3 and klit habitat types", echo=FALSE, cache=TRUE}

```


### Natura 2000

As it was done with Paragraph 3 before this, we rasterized and cropped this polygons to the area of Denmark as seen in the following code


<details style=\"margin-bottom:10px;\">
<summary>rasterize natura 2000</summary>
```{r Rasterize-Natura2000}

```
</details>

And then this is saved first as a geotiff and then exports it to a Cloud Optimized Geotiff with a deflate compression which is a lossless compression. as seen in the following code

<details style=\"margin-bottom:10px;\">
<summary>Write natura 2000</summary>
```{r Write-Natura2000, cache = T}

```
</details>

the results can be seen in figure \@ref(fig:PlotNatura-2000)

```{r PlotNatura-2000, fig.cap= "Plot of the areas of Natura 2000", echo=FALSE, cache=TRUE}

```

### Markblokkort

For this layer we also rasterized to 10 by 10 meters as seen in the code bellow

<details style=\"margin-bottom:10px;\">
<summary>rasterize Markblokkort</summary>
```{r Rasterize-markblokkort}

```
</details>

And then this is saved first as a geotiff and then exports it to a Cloud Optimized Geotiff with a deflate compression which is a lossless compression. as seen in the following code

<details style=\"margin-bottom:10px;\">
<summary>Write markblokkort</summary>
```{r Write-markblokkort, cache = T}

```
</details>

the results can be seen in figure \@ref(fig:Plotmarkblokkort)

```{r Plotmarkblokkort, fig.cap= "Plot of permanent grasslands and plough areas in markblokkort", echo=FALSE, cache=TRUE}

```

### Nature and wildlife reserves

For this layer we also rasterized to 10 by 10 meters as seen in the code bellow

<details style=\"margin-bottom:10px;\">
<summary>rasterize Nature and wildlife reserves</summary>
```{r Rasterize-NaturaOgVildtreservater}

```
</details>

And then this is saved first as a geotiff and then exports it to a Cloud Optimized Geotiff with a deflate compression which is a lossless compression. as seen in the following code

<details style=\"margin-bottom:10px;\">
<summary>Write Nature and wildlife reserves</summary>
```{r Write-NaturaOgVildtreservater, cache = T}

```
</details>

the results can be seen in figure \@ref(fig:PlotNaturaOgVildtreservater)

```{r PlotNaturaOgVildtreservater, fig.cap= "Plot of Nature and wildlife reserves", echo=FALSE, cache=TRUE}

```

### IUCN

For this layer we also rasterized to 10 by 10 meters as seen in the code bellow

<details style=\"margin-bottom:10px;\">
<summary>rasterize IUCN</summary>
```{r Rasterize-IUCN}

```
</details>

And then this is saved first as a geotiff and then exports it to a Cloud Optimized Geotiff with a deflate compression which is a lossless compression. as seen in the following code

<details style=\"margin-bottom:10px;\">
<summary>Write IUCN reserves</summary>
```{r Write-IUCN, cache = T}

```
</details>

the results can be seen in figure \@ref(fig:PlotIUCN)

```{r PlotIUCN, fig.cap= "Plot of IUCN areas", echo=FALSE, cache=TRUE}

```

### Untouched forest

For this layer we also rasterized to 10 by 10 meters as seen in the code bellow

<details style=\"margin-bottom:10px;\">
<summary>rasterize Untouched forest</summary>
```{r Rasterize-Urort-Skov}

```
</details>

And then this is saved first as a geotiff and then exports it to a Cloud Optimized Geotiff with a deflate compression which is a lossless compression. as seen in the following code

<details style=\"margin-bottom:10px;\">
<summary>Write untouched forest</summary>
```{r Write-Urort-skov, cache = T}

```
</details>

the results can be seen in figure \@ref(fig:PlotUrortSkov)

```{r PlotUrortSkov, fig.cap= "Plot of untouched forests", echo=FALSE, cache=TRUE}

```

### Nature National Parks

For this layer we also rasterized to 10 by 10 meters as seen in the code bellow

<details style=\"margin-bottom:10px;\">
<summary>rasterize Nature National Parks</summary>
```{r Rasterize-naturnationalpark}

```
</details>

And then this is saved first as a geotiff and then exports it to a Cloud Optimized Geotiff with a deflate compression which is a lossless compression. as seen in the following code

<details style=\"margin-bottom:10px;\">
<summary>Write Nature National Parks</summary>
```{r Write-naturnationalpark, cache = T}

```
</details>

### Subsidy schemes

For this layer we also rasterized to 10 by 10 meters as seen in the code bellow

<details style=\"margin-bottom:10px;\">
<summary>rasterize Subsidy</summary>
```{r Rasterize-stoette}

```
</details>

And then this is saved first as a geotiff and then exports it to a Cloud Optimized Geotiff with a deflate compression which is a lossless compression. as seen in the following code

<details style=\"margin-bottom:10px;\">
<summary>Write subsidies</summary>
```{r Write-stoette, cache = T}

```
</details>

the results can be seen in figure \@ref(fig:Plotstoette)

```{r Plotstoette, fig.cap= "Plot of subisdy areas", echo=FALSE, cache=TRUE}

```

## Results

To get the results we need to make a stack of all the layers

```{r AllStack}

```

and then we crosstabulate to solve for all the intersections

```{r crosstab}

```

The table generated with crosstab will have names that are not understandable, hence a lot of the columns must be renamed:

<details style=\"margin-bottom:10px;\">
<summary>Generate 1st summary table</summary>
```{r summary-table, cache = T}

```
</details>

This leads to the table \@ref(tab:table-overlap)

<details style=\"margin-bottom:10px;\">
<summary>Long table of overlap</summary>
```{r table-overlap, cache = T, echo=F}

```
</details>

From this we can generate a summary table with the general overlap as follows:

<details style=\"margin-bottom:10px;\">
<summary>Code for summary of general overlap</summary>
```{r table-general-overlap-creation, cache = T}

```
</details>

This generates a summarized table shown in table \@ref(tab:table-overlap-summarized)

<details style=\"margin-bottom:10px;\">
<summary>General table of overlap</summary>
```{r table-overlap-summarized, cache = T, echo=F}

```
</details>

# Ocean ecosystems

# Session info

<details style=\"margin-bottom:10px;\">
<summary>Session info</summary>
```{r }
sessioninfo::session_info()
```
</details>

# References
